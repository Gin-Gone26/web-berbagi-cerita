/*! For license information please see 742.0982c8844f8e9c502aae.js.LICENSE.txt */
"use strict";(self.webpackChunkweb_berbagi_cerita=self.webpackChunkweb_berbagi_cerita||[]).push([[629,742],{629:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var r=n(891),i=n(468),o=n(365);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function c(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var c=r&&r.prototype instanceof u?r:u,l=Object.create(c.prototype);return s(l,"_invoke",function(n,r,i){var o,c,s,u=0,l=i||[],d=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return o=t,c=0,s=e,p.n=n,a}};function f(n,r){for(c=n,s=r,t=0;!d&&u&&!i&&t<l.length;t++){var i,o=l[t],f=p.p,h=o[2];n>3?(i=h===r)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=f&&((i=n<2&&f<o[1])?(c=0,p.v=r,p.n=o[1]):f<h&&(i=n<3||o[0]>r||r>h)&&(o[4]=n,o[5]=r,p.n=h,c=0))}if(i||n>1)return a;throw d=!0,r}return function(i,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,h),c=l,s=h;(t=c<2?e:s)||!d;){o||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(u=2,o){if(c||(i="next"),t=o[i]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);o=e}else if((t=(d=p.n<0)?s:n.call(r,p))!==a)break}catch(t){o=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,i,o),!0),l}var a={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(s(t={},r,function(){return this}),t),f=d.prototype=u.prototype=Object.create(p);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=d,s(f,"constructor",d),s(d,"constructor",l),l.displayName="GeneratorFunction",s(d,i,"GeneratorFunction"),s(f),s(f,i,"Generator"),s(f,r,function(){return this}),s(f,"toString",function(){return"[object Generator]"}),(c=function(){return{w:o,m:h}})()}function s(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}s=function(e,t,n,r){function o(t,n){s(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},s(e,t,n,r)}function u(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,i)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function d(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}var p=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t},t=[{key:"submit",value:(n=c().m(function e(t){var n,a,s,u,l,d,p,f,h;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.description,a=t.photoFile,s=t.lat,u=t.lon,l=t.guest,d=void 0!==l&&l,this.view.showSaving(),e.p=1,e.n=2,r.A.addProduct({description:n,photoFile:a,lat:s,lon:u,guest:d});case 2:(0,i.P)("Cerita berhasil diunggah ke server ðŸŽ‰",3e3,"success"),this.view.showSaved(),e.n=7;break;case 3:return e.p=3,h=e.v,console.error("AddPresenter submit error:",h),p={description:n,lat:s,lon:u,guest:d,photoFile:a,createdAt:(new Date).toISOString()},e.n=4,o.DB.addPending(p);case 4:if(!("serviceWorker"in navigator)||!("SyncManager"in window)){e.n=6;break}return e.n=5,navigator.serviceWorker.ready;case 5:return f=e.v,e.n=6,f.sync.register("sync-new-story");case 6:this.view.showSavedWithWarning(h.message||"Offline - disimpan lokal"),(0,i.P)("Gagal unggah ke server. Cerita disimpan lokal untuk sinkronisasi.",4e3,"error");case 7:return e.a(2)}},e,this,[[1,3]])}),a=function(){var e=this,t=arguments;return new Promise(function(r,i){var o=n.apply(e,t);function a(e){u(o,r,i,a,c,"next",e)}function c(e){u(o,r,i,a,c,"throw",e)}a(void 0)})},function(e){return a.apply(this,arguments)})}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,a}()},742:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var r=n(629),i=(n(891),n(481)),o=n.n(i),a=n(468);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function s(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var s=r&&r.prototype instanceof c?r:c,l=Object.create(s.prototype);return u(l,"_invoke",function(n,r,i){var o,c,s,u=0,l=i||[],d=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return o=t,c=0,s=e,p.n=n,a}};function f(n,r){for(c=n,s=r,t=0;!d&&u&&!i&&t<l.length;t++){var i,o=l[t],f=p.p,h=o[2];n>3?(i=h===r)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=f&&((i=n<2&&f<o[1])?(c=0,p.v=r,p.n=o[1]):f<h&&(i=n<3||o[0]>r||r>h)&&(o[4]=n,o[5]=r,p.n=h,c=0))}if(i||n>1)return a;throw d=!0,r}return function(i,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,h),c=l,s=h;(t=c<2?e:s)||!d;){o||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(u=2,o){if(c||(i="next"),t=o[i]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);o=e}else if((t=(d=p.n<0)?s:n.call(r,p))!==a)break}catch(t){o=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,i,o),!0),l}var a={};function c(){}function l(){}function d(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(u(t={},r,function(){return this}),t),f=d.prototype=c.prototype=Object.create(p);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=d,u(f,"constructor",d),u(d,"constructor",l),l.displayName="GeneratorFunction",u(d,i,"GeneratorFunction"),u(f),u(f,i,"Generator"),u(f,r,function(){return this}),u(f,"toString",function(){return"[object Generator]"}),(s=function(){return{w:o,m:h}})()}function u(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}u=function(e,t,n,r){function o(t,n){u(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},u(e,t,n,r)}function l(e,t,n,r,i,o,a){try{var c=e[o](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,i)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){l(o,r,i,a,c,"next",e)}function c(e){l(o,r,i,a,c,"throw",e)}a(void 0)})}}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function f(e){var t=function(e){if("object"!=c(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:t+""}var h=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.presenter=new r.default(this),this.presenter=null,this.videoStream=null,this.photoFile=null,this.map=null,this.marker=null},t=[{key:"setPresenter",value:function(e){this.presenter=e}},{key:"render",value:function(){this.container.innerHTML='\n      <section aria-labelledby="add-title">\n        <h2 id="add-title">Tambah Cerita</h2>\n        <form id="add-form">\n          <fieldset>\n            <legend>Foto</legend>\n\n            <div class="camera-area">\n              <video id="camera" autoplay playsinline width="320" height="200" aria-hidden="true"></video>\n              <canvas id="capture" style="display:none"></canvas>\n            </div>\n\n            <div class="controls">\n              <label for="camera-select">Pilih Kamera:</label>\n              <select id="camera-select"></select>\n            </div>\n\n            <div class="controls">\n              <button type="button" id="start-camera">\n                <i class="fa-solid fa-video"></i>\n                <span class="btn-label">Buka Kamera</span>\n              </button>\n              <button type="button" id="take-photo" disabled>\n                <i class="fa-solid fa-camera"></i>\n                <span class="btn-label">Ambil Foto</span>\n              </button>\n              <button type="button" id="stop-camera" disabled>\n                <i class="fa-solid fa-power-off"></i>\n                <span class="btn-label">Matikan Kamera</span>\n              </button>\n            </div>\n\n            <p>Atau pilih dari file:</p>\n            <label class="file-upload">\n              <i class="fa-solid fa-upload"></i>\n              <span class="btn-label">Pilih File</span>\n              <input type="file" id="file-input" accept="image/*" hidden />\n            </label>\n\n            <div id="photo-preview" aria-live="polite"></div>\n            <p class="hint">Ukuran foto max 1MB. Jika lebih besar, akan dikompres otomatis.</p>\n          </fieldset>\n\n          <label for="description">Cerita Foto</label>\n          <textarea id="description" name="description" required aria-required="true" rows="3"></textarea>\n\n          <fieldset>\n            <legend>Pilih Lokasi (Klik pada peta)</legend>\n            <div id="mini-map" class="map-small" role="application" aria-label="Pilih lokasi"></div>\n            <p id="coords" class="coords">Belum dipilih</p>\n          </fieldset>\n\n          <div class="form-actions">\n            <button type="submit">Kirim</button>\n            <button type="button" id="save-guest">Kirim tanpa login (guest)</button>\n          </div>\n        </form>\n      </section>\n    ',this.bind(),this.initMiniMap()}},{key:"stopCamera",value:function(){if(this.videoStream){this.videoStream.getTracks().forEach(function(e){return e.stop()}),this.videoStream=null;var e=this.container.querySelector("#start-camera"),t=this.container.querySelector("#take-photo"),n=this.container.querySelector("#stop-camera");e&&t&&n&&(e.disabled=!1,t.disabled=!0,n.disabled=!0)}}},{key:"showSaving",value:function(){(0,a.P)("Menyimpan...",2e3,"info")}},{key:"showSaved",value:function(){(0,a.P)("Berhasil tersimpan",3e3,"success"),window.location.hash="/"}},{key:"showSavedWithWarning",value:function(e){(0,a.P)("Disimpan lokal: ".concat(e),4e3,"error"),window.location.hash="/"}},{key:"_showToast",value:function(e){(0,a.P)(e)}},{key:"bind",value:function(){var e=this,t=this.container.querySelector("#start-camera"),n=this.container.querySelector("#take-photo"),r=this.container.querySelector("#stop-camera"),i=this.container.querySelector("#camera"),o=this.container.querySelector("#capture"),c=this.container.querySelector("#photo-preview"),u=this.container.querySelector("#file-input"),l=this.container.querySelector("#add-form"),p=this.container.querySelector("#coords"),f=this.container.querySelector("#camera-select"),h=null,v=null;navigator.mediaDevices.enumerateDevices().then(function(e){var t=e.filter(function(e){return"videoinput"===e.kind});f.innerHTML=t.map(function(e){return'<option value="'.concat(e.deviceId,'">').concat(e.label||"Kamera","</option>")}).join("")}),u.addEventListener("change",function(){var t=d(s().m(function t(n){var r,i,o,u,l,d;return s().w(function(t){for(;;)switch(t.n){case 0:if(r=n.target.files[0]){t.n=1;break}return t.a(2);case 1:if(!(r.size>1048576)){t.n=4;break}return(i=new Image).src=URL.createObjectURL(r),t.n=2,i.decode();case 2:return o=document.createElement("canvas"),u=o.getContext("2d"),l=i.width>1024?1024/i.width:1,o.width=i.width*l,o.height=i.height*l,u.drawImage(i,0,0,o.width,o.height),t.n=3,new Promise(function(e){return o.toBlob(e,"image/jpeg",.8)});case 3:d=t.v,e.photoFile=new File([d],"upload_".concat(Date.now(),".jpg"),{type:d.type}),t.n=5;break;case 4:e.photoFile=r;case 5:c.innerHTML='<img src="'.concat(URL.createObjectURL(e.photoFile),'" \n  alt="Preview foto" \n  style="max-width:100%;" \n  loading="lazy">'),(0,a.P)("Foto berhasil dimuat",2e3,"success");case 6:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),t.addEventListener("click",d(s().m(function o(){var c,u,l;return s().w(function(o){for(;;)switch(o.p=o.n){case 0:return o.p=0,c=f.value,u=c?{video:{deviceId:{exact:c}}}:{video:!0},o.n=1,navigator.mediaDevices.getUserMedia(u);case 1:return e.videoStream=o.v,i.srcObject=e.videoStream,o.n=2,i.play();case 2:n.disabled=!1,r.disabled=!1,t.disabled=!0,o.n=4;break;case 3:o.p=3,l=o.v,console.error("Gagal akses kamera:",l),(0,a.P)("Tidak bisa mengakses kamera: "+(l.message||l),4e3,"error");case 4:return o.a(2)}},o,null,[[0,3]])}))),n.addEventListener("click",d(s().m(function t(){var n,r,u;return s().w(function(t){for(;;)switch(t.n){case 0:return n=o.getContext("2d"),o.width=i.videoWidth,o.height=i.videoHeight,n.drawImage(i,0,0),t.n=1,e._compressCanvasToBlob(o,.8,1024);case 1:r=t.v,u=new File([r],"photo_".concat(Date.now(),".jpg"),{type:r.type}),e.photoFile=u,c.innerHTML='<img src="'.concat(URL.createObjectURL(u),'" \n  alt="Preview foto" \n  style="max-width:100%;" \n  loading="lazy">'),(0,a.P)("Foto berhasil diambil",2e3,"success");case 2:return t.a(2)}},t)}))),r.addEventListener("click",function(){e.stopCamera(),(0,a.P)("Kamera dimatikan",2e3,"info")}),l.addEventListener("submit",function(){var t=d(s().m(function t(n){var r;return s().w(function(t){for(;;)switch(t.n){case 0:if(n.preventDefault(),r=l.description.value.trim()){t.n=1;break}return(0,a.P)("Deskripsi wajib diisi",3e3,"error"),t.a(2);case 1:if(e.photoFile){t.n=2;break}return(0,a.P)("Foto wajib diambil",3e3,"error"),t.a(2);case 2:return t.n=3,e.presenter.submit({description:r,photoFile:e.photoFile,lat:h,lon:v,guest:!1});case 3:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),this.container.querySelector("#save-guest").addEventListener("click",d(s().m(function t(){var n;return s().w(function(t){for(;;)switch(t.n){case 0:if(n=l.description.value.trim()){t.n=1;break}return(0,a.P)("Deskripsi wajib diisi",3e3,"error"),t.a(2);case 1:if(e.photoFile){t.n=2;break}return(0,a.P)("Foto wajib diambil",3e3,"error"),t.a(2);case 2:return t.n=3,e.presenter.submit({description:n,photoFile:e.photoFile,lat:h,lon:v,guest:!0});case 3:return t.a(2)}},t)}))),this._setCoordsSetter(function(e,t){h=e,v=t,p.textContent="Lat: ".concat(e.toFixed(5),", Lon: ").concat(t.toFixed(5)),(0,a.P)("Lokasi dipilih",2e3,"info")})}},{key:"_compressCanvasToBlob",value:(n=d(s().m(function e(t){var n,r,i,o,a,c,u=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:.9,r=u.length>2&&void 0!==u[2]?u[2]:1024,i=t.width,o=t.height,1===(a=i>r?r/i:1)){e.n=1;break}return(c=document.createElement("canvas")).width=Math.round(i*a),c.height=Math.round(o*a),c.getContext("2d").drawImage(t,0,0,c.width,c.height),e.a(2,new Promise(function(e){return c.toBlob(e,"image/jpeg",n)}));case 1:return e.a(2,new Promise(function(e){return t.toBlob(e,"image/jpeg",n)}))}},e)})),function(e){return n.apply(this,arguments)})},{key:"initMiniMap",value:function(){var e=this;this.map&&this.map.remove(),this.map=o().map("mini-map",{center:[0,0],zoom:2,attributionControl:!1});var t=o().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap"}),n=o().tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:"Â© Carto"}),r=o().tileLayer("https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{subdomains:["mt0","mt1","mt2","mt3"],attribution:"Â© Google"});t.addTo(this.map);var i={OpenStreetMap:t,"Dark Mode":n,Satellite:r};o().control.layers(i).addTo(this.map),this.map.on("click",function(t){var n=t.latlng,r=n.lat,i=n.lng;e.marker?e.marker.setLatLng([r,i]):e.marker=o().marker([r,i]).addTo(e.map),e._setCoords&&e._setCoords(r,i)}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){return e.map.setView([t.coords.latitude,t.coords.longitude],12)},function(){})}},{key:"_setCoordsSetter",value:function(e){this._setCoords=e}}],t&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}()}}]);